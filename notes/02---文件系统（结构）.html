<html>
<head>
  <title>02---文件系统（结构）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="843"/>
<h1>02---文件系统（结构）</h1>

<div>
<span><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">一个磁盘分成多个分区</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">文件系统中存储的最小单位是块  （启动块</span><span style="font-size: 12pt; font-family: Monaco;"><font color="#FF0000">Boot Block</font></span><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">是1k）</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">1块 = 8磁盘扇区（也有可能是其他情况）</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">1磁盘扇区 = 512B</span></div></div><div><font style="font-size: 12pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">stat 文件   //查看文件所占IO块</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><img src="02---文件系统（结构）_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">每个分区组成：</span></font></div><div><font style="font-size: 12pt;">启动块(Boot Block)：</font><font style="font-size: 12pt;">存储磁盘分区信息和启动信息，任何文件系统都不能使用启动块</font></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">块组(Block Group)：</span><font style="font-size: 12pt;">ext2文件系统将整个分区划成若干个同样大小的块组。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;color: rgb(51, 51, 51);font-family: Monaco;background-color: rgb(255, 250, 165);-evernote-highlight:true;">每个块组组成：</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">超级块：</span><font style="font-size: 12pt;">块大小、文件系统版本号、上次mount的时间等等。超级块在每个块组的开头都有一份拷贝。</font></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">块组描述符表：</span> <font style="font-size: 12pt;">由很多块组描述符组成，整个分区分成多少个块组就对应有多少个块组描述符。</font></div><div><font style="font-size: 12pt;"><u>块组描述符表：每个块组描述符（Group Descriptor）存储一个块组的描述信息，例如在这个块组中从哪里开始是inode表，从哪里开始是数 据块，空闲的 inode和数据块还有多少个等等。</u></font></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">块位图：</span><font style="font-size: 12pt;">块位图就是用来描述整个块组中哪些块已用哪些块空闲的。用<b>比特位</b>表示</font></div><div><font style="font-size: 12pt;"><font>inode位图：</font>和块位图类似，本身占一个块，其中每个bit表示一个 inode是否空闲可用。</font></div><div><font style="font-size: 12pt;"><font>inode表：</font>一个块组中的所有inode组成了inode表。</font></div><div><u><font style="font-size: 12pt;">inode(128B)：</font><font style="font-size: 12pt;">文件类型，权限，文件大小，创建/修改/访问时间等，也就是ls -l命令看到的那些信息，这些信息存在inode中</font></u></div><div><font style="font-size: 12pt;">数据块：数据、目录等，大小是一个个block</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt; font-family: Monaco;"><font color="#147191">存一个文件：</font></span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">首先申请一个inode（通过GDT找到一个空闲inode），inode的数据块指针指向存数据的数据块，</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">同时块位图的相应位置置为1，表示块被占用。如果数据特别大，则最后一个数据块指针，指向的数据块中存放指针（一级间接寻址）。</span></div></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#147191" style="font-size: 12pt;">删一个文件：</font></div><div><font style="font-size: 12pt;">先把块位图置为0，再把inode位图中对应的inode置为0</font></div></div><div><span style="font-size: 12pt;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;"><font color="#147191">寻址：</font></font></div><div><font style="font-size: 12pt;">目录文件中存放一个个记录项，表示一个个文件</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><img src="02---文件系统（结构）_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">数据块指针有15个，最后三个间接寻址<br/></font></div></div><div><span style="font-size: 12pt;"><img src="02---文件系统（结构）_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div></span>
</div></body></html> 