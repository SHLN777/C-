<html>
<head>
  <title>01---带参数的信号、坐标、菜单栏</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="552"/>
<h1>01---带参数的信号、坐标、菜单栏</h1>

<div>
<span><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">带参数的信号</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">信号可以重载</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">&quot;<font color="#6A0081">子窗口</font>&quot;</font></div><div><font style="font-size: 12pt;">signals:</font></div><div><font style="font-size: 12pt;">    /*信号必须有signals关键字来声明</font></div><div><font style="font-size: 12pt;">     *信号没有返回值，但可以有参数</font></div><div><font style="font-size: 12pt;">     *信号就是函数的声明，只需声明，无需定义</font></div><div><font style="font-size: 12pt;">     *使用：emit mySignal();</font></div><div><font style="font-size: 12pt;">     *信号可以重载</font></div><div><font style="font-size: 12pt;">    */</font></div><div><font style="font-size: 12pt;">    <b>void mySignal();</b></font></div><div><font style="font-size: 12pt;"><b>    void mySignal(int, QString);</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font color="#E30000" style="font-size: 12pt;">void (SubWidget::*testSignal)() = &amp;SubWidget::mySignal;</font></div><div><font style="font-size: 12pt;">connect(&amp;w, testSignal, this, &amp;MainWidget::dealSub);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font color="#E30000" style="font-size: 12pt;">void (&amp;SubWidget::*funSignal)(int, QString)() = &amp;SubWidget::mySignal;</font></div><div><font style="font-size: 12pt;">connect(&amp;w, funSignal, this, &amp;MainWidget::dealSlot);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">void MainWidget::dealSlot(int a, QString str)</font></div><div><font style="font-size: 12pt;">{</font></div><div><font style="font-size: 12pt;">    qDebug()&lt;&lt;a&lt;&lt;str.toUtf8().data();</font></div><div><font style="font-size: 12pt;">}</font></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#E30000" style="font-size: 12pt;">include &lt;QDebug&gt; //打印，相当于cout,cin</font></div><div><font color="#E30000" style="font-size: 12pt;">qDebug()&lt;&lt;a;</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#E30000" style="font-size: 12pt;">函数指针</font></div><div><font color="#E30000" style="font-size: 12pt;"><br/></font></div><div><font color="#E30000" style="font-size: 12pt;">void func()</font></div><div><font color="#E30000" style="font-size: 12pt;">{</font></div><div><font color="#E30000" style="font-size: 12pt;">}</font></div><div><font color="#E30000" style="font-size: 12pt;">void func(int);</font></div><div><font color="#E30000" style="font-size: 12pt;"><br/></font></div><div><font color="#E30000" style="font-size: 12pt;">void (*p)() = func;</font></div><div><font color="#E30000" style="font-size: 12pt;">void (*p)(int) = func;</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;"><font color="#E30000">str.toUtf8() -&gt; 字节数组QByteArray</font></font></div><div><font style="font-size: 12pt;"><font color="#E30000">...data() -&gt; QByteArray -&gt; char *</font></font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">Qt4信号连接</span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">Qt4槽函数必须有slots关键字来修饰</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">public:</font></div><div><font style="font-size: 12pt;">    MainWidget(QWidget *parent = 0);</font></div><div><font style="font-size: 12pt;">    ~MainWidget();</font></div><div><font color="#E30000" style="font-size: 12pt;">public slots:</font></div><div><font style="font-size: 12pt;">    void myslot();</font></div><div><font style="font-size: 12pt;">    void changeWin();</font></div><div><font style="font-size: 12pt;">    void dealSub();</font></div><div><font style="font-size: 12pt;">    void dealSlot(int, QString);</font></div><div><br/></div><div><font color="#147191" style="font-size: 12pt;">//connect(&amp;w, &amp;SubWidget::mySignal, this, &amp;MainWidget::dealSub);</font></div><div><font style="font-size: 12pt;">connect( &amp;w,SIGNAL(mySignal), this, SLOT() )</font></div><div><font style="font-size: 12pt;">connect( &amp;w,SIGNAL(mySignal(int,QString)), this, SLOT(dealSlot(int,QString)) );</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">Qt4缺陷：</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">SIGNAL  SLOT  将函数名字 -&gt; 字符串    不进行错误检查</span></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-family: Monaco; font-weight: bold;">Lambda表达式，匿名函数对象</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" style="font-size: 12pt;">项目文件：CONFIG += C++11</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">QPushButton *b = new QPushButton(this);</font></div><div><font style="font-size: 12pt;">int a,b;</font></div><div><font style="font-size: 12pt;">connect(b, &amp;QPushButton::released,</font></div><div><font style="font-size: 12pt;">        [<b>b</b>]()</font></div><div><font style="font-size: 12pt;">        {</font></div><div><font style="font-size: 12pt;">            <b>b-&gt;setText(&quot;123&quot;);</b></font></div><div><font style="font-size: 12pt;">            qDebug &lt;&lt; &quot;123456&quot;;</font></div><div><font style="font-size: 12pt;">        }</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">        );</font></div><div><font style="font-size: 12pt;">[]:</font></div><div><font style="font-size: 12pt;">可以传参[b,a,b]</font></div><div><font style="font-size: 12pt;">[=]：(把外部所有局部变量、类中所有成员以值传递方式)</font></div><div><font style="font-size: 12pt;">[this]：类中所有成员以值传递方式</font></div><div><font style="font-size: 12pt;">&amp;：把外部所有局部变量，引用符号，有点问题</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">a,b等只读，可以加mutable:<font color="#147191">[]()mutable</font></font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">传参</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">connect(b, &amp;QPushButton::clicked,</font></div><div><font style="font-size: 12pt;">        [=](bool isCheck)</font></div><div><font style="font-size: 12pt;">        {</font></div><div><font style="font-size: 12pt;">            qDebug() &lt;&lt; isCheck;</font></div><div><font style="font-size: 12pt;">        }</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">        );</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">坐标</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">对于主窗口，坐标系统相对于屏幕</font></div><div><font style="font-size: 12pt;">原点：相对于屏幕左上角</font></div><div><font style="font-size: 12pt;">x：往右递增</font></div><div><font style="font-size: 12pt;">y：往下递增</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">move(100,100);</font></div><div><font style="font-size: 12pt;">resize(500,500);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">对于子窗口，坐标相对于父窗口</font></div><div><font style="font-size: 12pt;">QPushButton *b1 = new QPushButton(this);</font></div><div><font style="font-size: 12pt;">b1-&gt;move(20,20);</font></div><div><font style="font-size: 12pt;">b1-&gt;setText(&quot;^_^&quot;);</font></div><div><font style="font-size: 12pt;">b1-&gt;resize(100,100);</font></div><div><font color="#E30000" style="font-size: 12pt;"><b>//b1.setGeometry(100,100,200,200); x,y=100; 长宽为：200</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">QPushButton *b2 = new QPushButton(<b>b1</b>);</font></div><div><font style="font-size: 12pt;">b2-&gt;move(10,10);</font></div><div><font style="font-size: 12pt;">b2-&gt;setText(&quot;@_@&quot;);</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">内存回收机制</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">1.指定父对象后</font></div><div><font style="font-size: 12pt;">2.直接或间接继承于QObject</font></div><div><font color="#E30000" style="font-size: 12pt;">子对象如果是动态分配空间的new，不需要手动释放delete</font></div><div><font color="#E30000" style="font-size: 12pt;">系统会自动释放</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;"><font color="#E30000">QObject &lt;-- QWidget &lt;-- QAbstractButton &lt;-- QPushButton</font></font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(173, 0, 0); font-weight: bold;">菜单栏</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">#include &quot;mainwindow.h&quot;</font></div><div><font style="font-size: 12pt;">#include &lt;QMenuBar&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QMenu&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QAction&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QDebug&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QToolBar&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QPushButton&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QStatusBar&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;QLabel&gt;</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt; font-family: Monaco;"><font color="#AD0000"><b>1.添加菜单栏，添加菜单，添加菜单项</b></font></span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><font style="font-size: 12pt;">//菜单栏</font></div><div><font style="font-size: 12pt;">    QMenuBar *mBar = menuBar();</font></div><div><font style="font-size: 12pt;">    setMenuBar(mBar);</font></div><div><font style="font-size: 12pt;">//添加菜单</font></div><div><font style="font-size: 12pt;">    QMenu *pFile = <font color="#E30000">mBar-&gt;addMenu</font>(&quot;文件&quot;);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">    //添加菜单项，添加动作</font></div><div><font style="font-size: 12pt;">    QAction *pNew= <font color="#E30000">pFile-&gt;addAction</font>(&quot;新建&quot;);</font></div><div><font style="font-size: 12pt;">    connect(pNew, &amp;QAction::triggered,</font></div><div><font style="font-size: 12pt;">            [=]()</font></div><div><font style="font-size: 12pt;">            {</font></div><div><font style="font-size: 12pt;">                qDebug() &lt;&lt;&quot;新建被按下&quot;;</font></div><div><font style="font-size: 12pt;">            }</font></div><div><font style="font-size: 12pt;">    );</font></div><div><font style="font-size: 12pt;">   <font color="#E30000"> pFile-&gt;addSeparator</font>();  //添加分割线</font></div><div><font style="font-size: 12pt;">    QAction *pOpen= pFile-&gt;addAction(&quot;打开&quot;);</font></div><div><font style="font-size: 12pt;">    //pFile-&gt;addAction(&quot;删除&quot;);</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#AD0000" style="font-size: 12pt;"><b>2.添加工具栏</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">//工具栏,菜单项的快捷方式</font></div><div><font style="font-size: 12pt;">    QToolBar *toolBar = <font color="#E30000">addToolBar</font>(&quot;toolBar&quot;);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">    toolBar-&gt;<font color="#E30000">addAction</font>(pNew); //工具栏添加快捷键</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">    QPushButton *b = new QPushButton(this);</font></div><div><font style="font-size: 12pt;">    b-&gt;setText(&quot;^_^&quot;);</font></div><div><font style="font-size: 12pt;">    toolBar-&gt;<font color="#E30000">addWidget</font>(b); //添加小控件</font></div><div><font style="font-size: 12pt;">    connect(b,&amp;QPushButton::clicked,</font></div><div><font style="font-size: 12pt;">            [=]()</font></div><div><font style="font-size: 12pt;">            {</font></div><div><font style="font-size: 12pt;">               b-&gt;setText(&quot;123&quot;);</font></div><div><font style="font-size: 12pt;">            }</font></div><div><font style="font-size: 12pt;">            );</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#AD0000" style="font-size: 12pt;"><b>3.状态栏</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">//状态栏</font></div><div><font style="font-size: 12pt;">    QStatusBar *sBar = statusBar();</font></div><div><font style="font-size: 12pt;">    QLabel *label = new QLabel(this);</font></div><div><font style="font-size: 12pt;">    label-&gt;setText(&quot;Normal text file&quot;);</font></div><div><font style="font-size: 12pt;">    sBar-&gt;<font color="#E30000">addWidget</font>(label);</font></div><div><font style="font-size: 12pt;">    //addWidget从左往右添加</font></div><div><font style="font-size: 12pt;">    sBar-&gt;<font color="#E30000">addWidget</font>(new QLabel(&quot;2&quot;,this));</font></div><div><font style="font-size: 12pt;">    //addPermanentWidget从右往左</font></div><div><font style="font-size: 12pt;">    sBar-&gt;<font color="#E30000">addPermanentWidget</font>(new QLabel(&quot;3&quot;,this));</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#AD0000" style="font-size: 12pt;"><b>4.核心控件</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">//核心控件</font></div><div><font style="font-size: 12pt;">    QTextEdit *textEdit = new QTextEdit(this);</font></div><div><font style="font-size: 12pt;">    <font color="#E30000">setCentralWidget</font>(textEdit);</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#AD0000" style="font-size: 12pt;"><b>5.浮动窗口</b></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">//浮动窗口</font></div><div><font style="font-size: 12pt;">    QDockWidget *dock = new QDockWidget(this);</font></div><div><font style="font-size: 12pt;">    <font color="#E30000">addDockWidget</font>(Qt::RightDockWidgetArea,dock);</font></div><div><font style="font-size: 12pt;">    //给浮动窗口添加控件</font></div><div><font style="font-size: 12pt;">    QTextEdit *textEdit1 = new QTextEdit(this);</font></div><div><font style="font-size: 12pt;">    dock-&gt;<font color="#E30000">setWidget</font>(textEdit1);</font></div></div><div><font style="font-size: 12pt;"><br/></font></div></span>
</div></body></html> 