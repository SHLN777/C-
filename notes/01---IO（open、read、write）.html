<html>
<head>
  <title>01---I/O（open、read、write）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="806"/>
<h1>01---I/O（open、read、write）</h1>

<div>
<span><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><img src="01---IO（open、read、write）_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt;">每个文件都有一个缓冲区，首先把数据写入缓冲区，然后内核再从缓冲区输入到相应的设备</span></div></div><div><font color="#E30000" style="font-size: 12pt;"><br/></font></div><div><span style="color: rgb(227, 0, 0); font-size: 12pt;">man  2  *  （我们看到的都是被umask修改过的权限）</span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">一、open</span></font></div><div><font style="font-size: 12pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">#include &lt;sys/types.h&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;sys/stat.h&gt;</font></div><div><font style="font-size: 12pt;">#include &lt;fcntl.h&gt;</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="background-color: initial;"><font style="font-size: 12pt;">int open(const char *pathname, int flags);</font></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">int open(const char *pathname, int flags, mode_t mode);</font></div><div><font style="font-size: 12pt;">返回值：成功返回新分配的文件描述符，出错返回-1并设置errno</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">参数：</font></div><div><font style="font-size: 12pt;">flags:O_RDONLY 只读打开</font></div><div><font style="font-size: 12pt;">      O_WRNOLY 只写打开</font></div><div><font style="font-size: 12pt;">      O_RDWR  可读可写打开</font></div><div><font style="font-size: 12pt;">以下选项可以和必选项按位或起来作为flags参数</font></div><div><font style="font-size: 12pt;">      O_APPEND  追加</font></div><div><font style="font-size: 12pt;">      O_CREAT  文件不存在则创建它</font></div><div><font style="font-size: 12pt;">      O_EXCL  如果同时指定了O_CREAT,并且文件已经存在，则出错返回</font></div><div><font style="font-size: 12pt;">      O_TRUNC  如果文件已存在，并且以只写或可读可写方式打开，则将其长度截断为0字节</font></div></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt;"><font style="color: rgb(20, 113, 145);">实例</font></span></div><div><span style="font-size: 14pt;"><img src="01---IO（open、read、write）_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(20, 113, 145);">gcc  main.c  -o  app</span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(20, 113, 145);">./app  hello</span></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">#include &lt;unistd.h&gt;</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">int close(int fd);</font></div><div><font style="font-size: 12pt;">size_t write(int fd, const void *buf, size_t count);</font></div></div><div><img src="01---IO（open、read、write）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">如果文件已经存在，则</span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco;">fd = open(argv[1], O_REWR)  </span></div></div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-size: 12pt;">能打开的最大文件数（1024）</span></div><div><span style="font-size: 12pt;"><img src="01---IO（open、read、write）_files/Image [3].png" type="image/png" data-filename="Image.png"/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">ulimit -a    查看最大打开数</font></div><div><font style="font-size: 12pt;">ulimit -n 4096   改变最大打开数</font></div><div><font style="font-size: 12pt;">cat /pro/sys/fs/file-max   电脑可以打开的文件数</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 14pt;">二、read</span></div><div><span style="font-size: 12pt;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">#include &lt;unistd.h&gt;</font></div><div><font style="font-size: 12pt;">ssize_t read(int fd, void *buf, size_t count);  //<font color="#E30000"><b>读到缓冲区</b></font></font></div><div><font style="font-size: 12pt;">返回值：成功返回读取的字节数，出错返回-1并设置errno，</font><font style="font-size: 12pt;">如果在调read之前已到达文件末尾，则这次read返回0</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="color: rgb(20, 113, 145); font-size: 14pt;"><b>拷贝案例</b></font></div><div><span style="font-size: 12pt;"><img src="01---IO（open、read、write）_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="01---IO（open、read、write）_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div></span>
</div></body></html> 