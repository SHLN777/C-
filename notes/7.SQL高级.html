<html>
<head>
  <title>7.SQL高级</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="600"/>
<h1>7.SQL高级</h1>

<div>
<span><div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(227, 0, 0); font-weight: bold;">1.视图</span></font></div><div><span style="font-size: 10pt;"><br/></span></div><div>视图就是一条SELECT语句执行后返回的结果集，所以我们在创建视图的时候，主要工作就落在创建这条SQL查询语句上</div><div>视图对若干张基本表的引用，一张虚表，查询语句执行的结果，不存储具体的数据（<span style="color: rgb(227, 0, 0);">基本表数据发生了改变，视图也跟着改变</span>）</div><div><br/></div><div>方便操作，特别是查询操作，减少复杂的SQL语句，增强可读性</div><div><img src="7.SQL高级_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0); font-weight: bold;">定义视图</span></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-weight: bold;">目的：方便查数据，不能修改</span></div><div><span style="font-size: 10pt; font-weight: bold;"> 建议以v...开头</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;"><b>create view</b> 视图名称 as select语句</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">#三张表连接</font></div><div><font style="font-size: 11pt;"><font color="#E30000">create view v_goods_info as</font> select <font color="#1C3387"><b>g.*,c.name as cate_name,b.name as brand_name </b> </font>   </font></div><div><font style="font-size: 11pt;">                                from <font color="#000000" style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">goods as g</font> left join <font color="#41007D" style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">goods_cates as c</font> on </font></div><div><font style="font-size: 11pt;">                                g.cate_id=c.id left join <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font color="#41007D">goods_brands</font> as b</span> on </font></div><div><font style="font-size: 11pt;">                                g.brand_id=b.id;</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">查看视图</font></div><div><font style="font-size: 11pt;">select * from v_goods_info</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">删除视图</font></div><div><font style="font-size: 11pt;">drop view 视图名</font></div><div><font style="font-size: 10pt;"><br/></font></div></div><div><br/></div><div>视图的作用</div><ol><li><div>提高了重用性，就像一个函数一样</div></li><li><div>对数据库重构，却不影响程序的运行</div></li><li><div>提高了安全性能，可以对不同的用户</div></li><li><div>让数据更加清晰</div></li></ol><div><br/></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(227, 0, 0); font-weight: bold;">2.事务（增删改有用）</span></font></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">所谓事务，就是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。</span></div><div><span style="font-size: 10pt;"><br/></span></div><div>事务的四大特性（ACID）</div><ul><li><div>原子性</div></li><div>一个事务被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，</div><div>要么全部失败回滚，对于一个事务来说，不可能只执行其中一部分操作。</div><div><br/></div><li><div>一致性</div></li><div>就算中间出了问题，数据还是不会变</div><div><br/></div><li><div>隔离性</div></li><div>一个事务所在的修改在最终提交以前，对其他的事务是不可见的。</div><div>共同对同一个数据操作，一个事务什么时候执行完，其它事务才能执行。</div><div><br/></div><li><div>持久性</div></li></ul><div style="margin-left: 40px;">一旦事务提交，其所做的修改会永久的保存到数据库</div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">可以用start transaction 语句开始一个事务，然后要么使用commit提交将修改的数据持久保存，</span></div><div>要么使用rollback撤销所有的修改。如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">1.start transaction;  或 begin;</font></div><div><font style="font-size: 11pt;">2.select balance from checking where customer_id = 10233276;</font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">3.updata checking set balance = balance-200.00 where customer_id=10233275;</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">4.updata saving set balance=balance+200.00 where customer_id=10233275;</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">5.commit;</font></span></div></div><div><span style="font-size: 10pt;">用python默认就是一个事务</span></div><div><span style="font-size: 10pt;">用MySQL客户端也是默认的，每条语句自动执行</span><span style="font-size: 10pt;">start transaction、</span><span style="font-size: 10pt;">commit</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><font style="font-size: 14pt;"><span style="color: rgb(227, 0, 0); font-size: 14pt; font-weight: bold;">3.索引</span></font></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">索引是一种特殊的文件，他们包含着对数据表里所有记录的引用指针。</span></div><div><span style="font-size: 10pt;">更通俗的说，数据库索引好比一本书的目录，能加快数据库的查询速度</span></div><div><span style="font-size: 10pt;">目的：提高查询的效率</span></div><div><span style="font-size: 10pt;">原理：通过不断地缩小想要获得数据的范围筛选出最终想要的结果</span></div><div><span style="font-size: 10pt;">主键和外键都是索引</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">开启运行时间检测：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>set profiling=1;</div></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">查找第1万条数据</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select * from test_index where title=&quot;ha---9999&quot;</div></div><div><span style="font-size: 10pt;"><br/></span></div><div>查看执行时间</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>show profiles;</div></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="color: rgb(227, 0, 0);">为表的字段创建索引</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create index 索引名 on 表(字段（10）);#如果字段是是字符串类型，要写数据的长度</div></div><div><span style="font-size: 10pt;"><br/></span></div><div>执行查询语句</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select * from test_index where title='ha-9999';</div></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">再次查看执行的时间</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>show profiles;</div></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">查看索引</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>show index from 表名;</div></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 