<html>
<head>
  <title>基础---3（内存、引用）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="622"/>
<h1>基础---3（内存、引用）</h1>

<div>
<span><div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">一、程序的内存模型</span></font></div><ul><li><div><span style="font-size: 12pt;">代码区：存放函数的二进制代码，由操作系统进行管理的</span></div></li><li><div><span style="font-size: 12pt;">全局区：存放全局变量和静态变量以及常量</span></div></li><li><div><span style="font-size: 12pt;">栈区：由编译器自动分配释放，存放函数的参数值，局部变量等</span></div></li><li><div><span style="font-size: 12pt;">堆区：有程序员分配和释放，若程序结束时由操作系统回收</span></div></li></ul><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(227, 0, 0); font-weight: bold;">程序运行前</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 12pt;">在程序编译后，生成exe可执行程序，<font color="#E30000"><b>未执行该程序前</b></font>分为两个区域</span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;">代码区：</span></div><div><span style="font-size: 12pt;">    存放CPU执行的机器指令</span></div><div><span style="font-size: 12pt;">    代码区是<font color="#E30000">共享</font>的，共享的目的是对于频繁被执行的程序，只需要在内存中有一份代码即可</span></div><div><span style="font-size: 12pt;">    代码区是<font color="#E30000">只读</font>的，使其只读的原因是防止程序意外的修改了它的指令</span></div><div><span style="font-size: 12pt;">全局区：</span></div><div><span style="font-size: 12pt;">    全局变量和静态变量存放在此</span></div><div><span style="font-size: 12pt;">    全局区还包含了常量区，字符串常量和其它常量也存放在此</span></div><div><span style="font-size: 12pt;">    <font color="#41007D">该区域的数据在</font><font color="#E30000">程序结束</font><font color="#41007D">后由操作系统释放</font></span></div></div><div><br/></div><div><font style="font-size: 12pt;"><span style="color: rgb(227, 0, 0); font-size: 12pt; font-weight: bold;">程序运行后</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">栈区：</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">    由编译器自动分配释放，存放函数的参数值，局部变量等</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;"><span style="color: rgb(51, 51, 51);">    </span>注意事项：<font color="#E30000">不要返回局部变量的地址</font>，栈区开辟的数据由编译器自动释放</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                    局部变量，存放在栈区，栈区的数据在函数执行完后自动释放</font></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">                    int*  func()</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">                    {</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">                        int a = 10;  </span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">                        return &amp;a;</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">                    }</span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                    int mian()</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                    {</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                        int *p = func();</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                        cout&lt;&lt;*p;  //第一次可以打印正确的数字，是因为编译器做了一次保留</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                        cout&lt;&lt;*p;  //第二次这个数字就不再保留了</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">                    }</font></span></div><div><br/></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">堆区：</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">    C++中主要用new在堆中开辟内存</font></span></div><div><span style="font-family: Monaco;"><font style="font-size: 11pt;">    <font color="#E30000">new int(10);  //返回new出的内存的一个地址</font></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">    </font></span>         <font style="font-size: 11pt;"> </font><font style="font-size: 11pt;">        int*  func()</font></div><div><font style="font-size: 11pt;">                    {</font></div><div><font style="font-size: 11pt;">                        int *p = new int(10);  </font></div><div><font style="font-size: 11pt;">                        return p;</font></div><div><font style="font-size: 11pt;">                    }</font></div><div><font style="font-size: 11pt;">                    int mian()</font></div><div><font style="font-size: 11pt;">                    {</font></div><div><font style="font-size: 11pt;">                        int *p = func();</font></div><div><font style="font-size: 11pt;">                        cout&lt;&lt;*p;  </font></div><div><font style="font-size: 11pt;">                        cout&lt;&lt;*p;</font></div><div><font style="font-size: 11pt;">                    }</font></div><div><font style="font-size: 11pt;">    在堆中开辟数组：</font></div><div><font style="font-size: 11pt;">            int *arr = new int[10];</font></div></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">二、引用</span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt;"><b>   </b> 引用必须初始化（引一块合法的内存空间，不可直接赋值）<br/></span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt;">    引用在初始化后，不可改变<br/></span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">1.引用做函数参数</font></div><div><font style="font-size: 11pt;"><span>    可以简化指针修改形参</span><br/></font></div><div><font style="font-size: 11pt;"><span><br/></span></font></div><div><font style="font-size: 11pt;"><span>2.引用做函数的返回值</span></font></div><div><font style="font-size: 11pt;"><span>    <font color="#E30000">不要返回局部变量引用</font><br/></span></font></div><div><font style="font-size: 11pt;"><span><font color="#E30000"><span>    返回全局变量时，如不是返回引用，则会创建一个临时变量接收值</span><br/></font></span></font></div><div><font style="font-size: 11pt;"><span><font color="#E30000"><span><span>    如果函数做左值，那么必须返回引用</span><br/></span></font></span></font></div><div><font style="font-size: 11pt;"><span><font color="#E30000"><span><span>    int&amp; test();</span><br/></span></font></span></font></div><div><font style="font-size: 11pt;"><span><font color="#E30000"><span><span>    test()=10;  //test()是一个引用，test()是原名</span><br/></span></font></span></font></div><div><span style="font-size: 11pt; font-family: Monaco;"><br/></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">3.引用的本质<br/></font></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span>    本质：引用的本质在C++内部实现是一个指针常量</span><br/></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><span>    所有的指针操作编译器都帮我们做了</span><br/></span></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><span>    int* const ref = &amp;a;</span><br/></span></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><br/></span></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><span>    int  a = 10;</span><br/></span></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><span>    int &amp;ref = a; //自动转换为：int* const ref = &amp;a;</span><br/></span></span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><span>    ref = 20; //内部发现是引用，自动转换为：*ref = 20;</span><br/></span></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">4.常量引用</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">作用：常量引用主要用来修饰形参，在函数形参中，加const修饰，防止形参改变实参</font></div><div><span style="font-size: 12pt;"><span>    int a=10;</span><br/></span></div><div><span style="font-size: 12pt;"><span>    int &amp; ref = 10; <font color="#E30000">（×）</font><br/></span></span></div><div><span style="font-size: 12pt;"><span><font color="#E30000"><br/></font></span></span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0); font-family: Monaco;"><span>    </span><span>    加const之后，编译器将代码修改，int temp=10; const int &amp; ref = temp;</span><br/></span></div><div><span style="font-size: 12pt;"><span>    const int &amp; ref = 10; <font color="#E30000">（√）</font><br/></span></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">5.<span>    </span><br/></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;"><span><span>    const  int  x = 3; int *p = &amp;x; （×）  //x只读，*p可读可写</span><br/></span></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;"><span><span>    int x=3; const  int *p = &amp;x ;  （√）  //x可读可写，*p只读</span><br/></span></font></span></div></div><div><br/></div><div><font style="font-size: 12pt;"><b>三、函数提高</b></font></div><div><br/></div><div><font style="font-size: 11pt;">1.函数默认参数</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">如果函数声明有默认参数，函数实现就不能有默认参数</font></span></div><div><span style="font-family: Monaco;"><font color="#E30000" style="font-size: 11pt;">声明和实现只能有一个有默认参数</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">int  func(int a=1, int b=2);<br/></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">int func(int a, int b)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">{</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;"><span>    return a+b;</span><br/></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">}</font></span></div></div><div><font style="font-size: 11pt;">2.函数占位参数</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">C++中函数的形参列表可以有占位参数，用来占位<br/></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">调用函数时必须填补该位置</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;"><br/></font></span></div><div><span style="font-family: Monaco;"><font color="#E30000" style="font-size: 11pt;">语法：返回值类型  函数名 （数据类型） { }</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;">可以有默认参数</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 11pt;"><span>    </span><span>    </span><span>    void  func(int a, int = 10);</span><br/></font></span></div></div><div><font style="font-size: 11pt;">3.函数重载</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">条件：</font></div><div><font style="font-size: 11pt;"><span>    同一个作用域下</span><br/></font></div><div><font style="font-size: 11pt;"><span><span>    函数名称相同</span><br/></span></font></div><div><font style="font-size: 11pt;">    函数参数<font color="#1C3387">类型不同</font>或<font color="#1C3387">个数不同</font>或<font color="#1C3387">顺序不同</font><br/></font></div><div><font style="font-size: 11pt;"><font color="#1C3387"><br/></font></font></div><div><span style="font-size: 11pt; font-family: Monaco;">注意：</span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span>    </span><span>    1.引用作为重载条件</span><br/></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span>                <font color="#E30000">void  func(int  &amp;a);  // int和const  int类型不同</font><font color="#E30000"><br/></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span>    </span><span>    </span><span>    </span><span>    void  func(const  int &amp;a);</span><br/></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span>    </span><span>    </span><span>    </span><span>    int a=1;</span><br/></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span>    </span><span>    </span><span>    </span><span>    func(a); //调用func(int &amp;a)，因为a是变量，可读可写</span></font><br/></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span><span>    </span><span>    </span><span>    </span><span>    func(10); //调用func(const int &amp;a), int &amp;a=10不合法</span><br/></span></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><br/></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><span>    </span><span>    2.函数重载碰到函数默认参数</span><br/></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span>              <font color="#E30000">  void  func(int  a, int  b=10);</font><font color="#E30000"><br/></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span>    </span><span>    </span><span>    </span><span>    void  func(int  a);</span><br/></font></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><font color="#E30000"><span>    </span><span>    </span><span>    </span><span>    func(10); //两个都可以运行，出现二义性</span></font><br/></span></span></div><div><span style="font-size: 11pt; font-family: Monaco;"><span><span>    </span><span>    </span><span>    </span><br/></span></span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 