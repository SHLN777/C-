<html>
<head>
  <title>6.用python操作mysql</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="602"/>
<h1>6.用python操作mysql</h1>

<div>
<span><div><img src="6.用python操作mysql_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(227, 0, 0); font-weight: bold;">查询几行数据 </span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt;">from pymysql import *</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">    def main():</font></div><div><font style="font-size: 11pt;">        #<font color="#E30000">1.</font>创建Connection连接</font></div><div><font style="font-size: 11pt;">        conn = connect(host='localhost',port=3306,user='root',password='mima',database='jing_dong',charset='utf8')</font></div><div><font style="font-size: 11pt;">        #<font color="#E30000">2.</font>获得Cursor对象（游标对象）</font></div><div><font style="font-size: 11pt;">        csl = conn.cursor()</font></div><div><font style="font-size: 11pt;">        #<font color="#E30000">3.</font>执行sql语句，并返回受影响的行数，查询一条数据</font></div><div><font style="font-size: 11pt;">        count = csl.execute('select id.name from goods where id&gt;=4')</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">        #<font color="#E30000">4.</font>通过游标对象取东西</font></div><div><font style="font-size: 11pt;">        cls.fetchone()</font></div><div><font style="font-size: 11pt;">        cls.fetchmany(n)</font></div><div><font style="font-size: 11pt;">        cls.fetchall()</font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;">        #关闭cursor</font></div><div><font style="font-size: 11pt;">        slc.close()</font></div><div><font style="font-size: 11pt;">        #关闭connection</font></div><div><font style="font-size: 11pt;">        conn.close()</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>line = cursor.fetchone() #返回一个元组</div><div>#可以通过下标取数据,line是一个元组里面嵌着多个元组</div><div>line[1]</div><div><br/></div><div>#打印一个数据每个字段的信息</div><div>for temp in line:</div><div>    print temp </div><div><br/></div><div>lines = cursor.fetchmany(5) #lines里面有五个元组</div></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(227, 0, 0); font-weight: bold;">案例：查询</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from pymysql import connect</div><div><br/></div><div>class JD():</div><div>    def __init__(self):</div><div>        self.conn = connect(host='localhost',port=3306,user='root',password='mima',database='jing_dong',charset='utf8')</div><div>        self.cursor = self.conn.cursor()</div><div><br/></div><div>    def __del__(self):</div><div>        self.cursor.close(）</div><div>        self.conn.close()</div><div><br/></div><div>    def execute_sql(self,sql):</div><div>        self.cursor.execute(sql)</div><div>        for temp in self.cursor.fetchall():</div><div>            print(temp)</div><div><br/></div><div>    def show_all_items():</div><div>        sql = &quot;select * from goods;&quot;</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">               self.execute_sql(sql)</span></div><div>    </div><div>    def show_cates(self):</div><div>        sql = &quot;select name from goods_cates;&quot;</div><div>        self.execute_sql(sql)</div><div><br/></div><div>    def show_brands(self):</div><div>        sql = &quot;select name from goods_brands&quot;</div><div>        self.execute_sql(sql)</div><div>    </div><div>    @staticmethod</div><div>    def print_menu():</div><div>        print(&quot;----京东商城----&quot;)</div><div>        print(&quot;1: 所有商品&quot;)</div><div>        print(&quot;2：所有商品分类&quot;)</div><div>        print(&quot;3: 所有商品品牌分类&quot;)</div><div>        return input(&quot;请输入查询序列:&quot;)</div><div><br/></div><div>    def run(self):</div><div>        while True:</div><div>            num = self.print_menu()</div><div>            if num == &quot;1&quot;:</div><div>                self.show_all_items()</div><div>            elif num == &quot;2&quot;:</div><div>                self.show_cates()</div><div>            elif num == &quot;3&quot;:</div><div>                self.show_brands()</div><div>            else:</div><div>                print(&quot;输入错误！&quot;)</div><div>def main():</div><div>    jd = JD()</div><div>    jd.run()</div><div><br/></div><div>if __name__ == &quot;__main__&quot;:</div><div>    main()</div></div><div><br/></div><div><br/></div><div><br/></div><div><font color="#E30000" style="font-size: 14pt;"><span style="color: rgb(227, 0, 0); font-size: 14pt; font-weight: bold;">pathon操作sql：添加、修改、删除数据</span></font></div><div><span style="font-size: 10pt;"><br/></span></div><div><br/></div><div>要执行conn.commit()去提交修改</div><div>可以用conn.rollback()倒回去</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font size="1">def add_brands(self):</font></div><div><font size="1">    item_name = input(&quot;输入添加的数据:&quot;)</font></div><div><font size="1">    sql = &quot;&quot;&quot;insert into goods_brands(name) value(&quot;%s&quot;)&quot;&quot;&quot; % item_name</font></div><div><font size="1">    self.cursor.execute(sql)</font></div><div>    self.conn.commit()</div><div><br/></div><div>def get_info_by_name():</div><div>    find_name = input(&quot;输入名字：&quot;)</div><div>    sql = &quot;&quot;&quot;select * from goods where name='%s';&quot;&quot;&quot; % find_name</div><div>    self.execute_sql(sql)</div><div><br/></div></div><div><br/></div><div>SQL注入</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>输入：' or 1=1 or '1</div><div>select * from goods where name='' or 1=1 or '1';</div><div>所以通过这个输入，就可以让数据库输出所有东西</div></div><div><br/></div><div>防止</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>find_name = input(&quot;输入名字：&quot;)</div><div>sql = &quot;&quot;&quot;select * from goods where name='%s';&quot;&quot;&quot; % find_name</div><div>self.cursor.execute(sql,[find_name])</div><div>print(self.cursor.fetchall())</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 