<html>
<head>
  <title>负采样</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="662"/>
<h1>负采样</h1>

<div>
<span><div><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-weight: bold; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; color: rgb(79, 79, 79); line-height: 32px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 24px; box-sizing: border-box; outline: 0px; font-weight: bold; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; color: rgb(79, 79, 79); line-height: 32px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NCE</span><span style="box-sizing: border-box; outline: 0px; font-weight: bold; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; color: rgb(79, 79, 79); line-height: 32px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 12pt;"> </font></span></h2><div style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px; padding: 0px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; color: rgb(77, 77, 77); line-height: 26px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; color: rgb(77, 77, 77); line-height: 26px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">负采样可以看成 NCE 的特化，所以有必要先讲一下 NCE。</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px; padding: 0px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; color: rgb(77, 77, 77); line-height: 26px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; color: rgb(77, 77, 77); line-height: 26px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">在 Softmax 回归中，样本属于某个分类的概率是：</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px; padding: 0px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; color: rgb(77, 77, 77); line-height: 26px; overflow-wrap: break-word; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><img src="负采样_files/Image.png" type="image/png" data-filename="Image.png"/></span><br/></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;">也就是说，要计算它属于某个分类的概率，就要把所有分类的概率都计算出来。有的时候算力计算一个是够的，但不够计算这么多。</span></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;">NCE 的想法很简洁，<b>把多分类变成二分类</b>，<b>还用相同的参数</b>。</span></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;">我们需要在数据集上采样。对于每个样本，它的特征为 x，选取它所属的类别 y0</span><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;; font-size: 12pt;">，并根据某个分布 N(y)选取 n 个其它类别 y1 ... yn</span><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;; font-size: 12pt;">。然后把每个 (x,yi)</span><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;; font-size: 12pt;"> 当做新样本的特征。</span></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div style="text-align: start;"><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;">然后给每个新样本一个标签 d，如果 x属于 yi</span><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;; font-size: 12pt;">，那么 d=1，否则 d=0。</span></div><div style="text-align: start;"><br/></div><div><span style="font-size: 18pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><b><img src="负采样_files/Image [1].png" type="image/png" data-filename="Image.png"/></b></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">然后整个问题就变成了优化  P(d=1∣y,x)。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">我们观察到，在新的数据集中，如果我们选取 d=1的样本，它们的 x,y 和原始样本一样。也就是：</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>P(y∣x,d=1)=P0(y∣x)</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">为了避免混淆，把原数据集上的那个函数加了个下标 0。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">如果我们选取 d=0的样本，它们的 y就是分布 N(y)。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>P(y∣x,d=0)=N(y)</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">还有，对于每个 x，d总会有一个 1 和 n 个 0。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><img src="负采样_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">把它们乘一起，就得到了联合分布：</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><img src="负采样_files/Image [3].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">然后计算需要优化的那个函数：</span></div><div><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 16px; font-variant-ligatures: common-ligatures; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><img src="负采样_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><font style="font-size: 18pt;"><b>负采样</b></font></span></div><div><span style="font-size: 12pt; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">在此基础上做了两个改动：</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">第一，把 N(y) 变成所抽样标签上的均匀分布，那么 nN(y)=1。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">第二，把配分项 Z 变成模型的一个参数 z。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">于是：</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><img src="负采样_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;">然后在多次试验中发现 z 始终等于 1，就把这项去掉了。现在它就是二分类了。</span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>   <span>    </span><span>    </span><span>    </span></span><img src="负采样_files/Image [6].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><b>优化的时候，我们随机选个 x。由于 y是均匀的，我们再随机选个 k，计算 P(d=1∣y,x)。之后再用它和 d算交叉熵损失，用梯度下降来更新参数即可。</b></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><br/></span></div><div><span style="font-size: 12pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;;"><b><br/></b></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><img src="负采样_files/Image [7].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div></div></span>
</div></body></html> 